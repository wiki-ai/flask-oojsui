/*! OOjs UI v0.19.5 | http://oojs.mit-license.org */
!function(a){"use strict";a.ui.mixin.DraggableElement=function(a){a=a||{},this.index=null,this.$handle=a.$handle||this.$element,this.wasHandleUsed=null,this.$element.addClass("oo-ui-draggableElement").attr("draggable",!0).on({mousedown:this.onDragMouseDown.bind(this),dragstart:this.onDragStart.bind(this),dragover:this.onDragOver.bind(this),dragend:this.onDragEnd.bind(this),drop:this.onDrop.bind(this)}),this.$handle.addClass("oo-ui-draggableElement-handle")},a.initClass(a.ui.mixin.DraggableElement),a.ui.mixin.DraggableElement.static.cancelButtonMouseDownEvents=!1,a.ui.mixin.DraggableElement.prototype.onDragMouseDown=function(b){this.wasHandleUsed=this.$handle[0]===this.$element[0]||a.ui.contains(this.$handle[0],b.target,!0)},a.ui.mixin.DraggableElement.prototype.onDragStart=function(a){var b=this,c=a.originalEvent.dataTransfer;if(!this.wasHandleUsed)return!1;c.dropEffect="none",c.effectAllowed="move";try{c.setData("application-x/OOjs-UI-draggable",this.getIndex())}catch(a){}return this.$element.addClass("oo-ui-draggableElement-clone"),setTimeout(function(){b.$element.removeClass("oo-ui-draggableElement-clone").addClass("oo-ui-draggableElement-placeholder")}),this.emit("dragstart",this),!0},a.ui.mixin.DraggableElement.prototype.onDragEnd=function(){this.$element.removeClass("oo-ui-draggableElement-placeholder"),this.emit("dragend")},a.ui.mixin.DraggableElement.prototype.onDrop=function(a){a.preventDefault(),this.emit("drop",a)},a.ui.mixin.DraggableElement.prototype.onDragOver=function(a){a.preventDefault()},a.ui.mixin.DraggableElement.prototype.setIndex=function(a){this.index!==a&&(this.index=a,this.$element.data("index",a))},a.ui.mixin.DraggableElement.prototype.getIndex=function(){return this.index},a.ui.mixin.DraggableGroupElement=function(b){b=b||{},a.ui.mixin.GroupElement.call(this,b),this.orientation=b.orientation||"vertical",this.dragItem=null,this.itemKeys={},this.dir=null,this.itemsOrder=null,this.aggregate({dragstart:"itemDragStart",dragend:"itemDragEnd",drop:"itemDrop"}),this.connect(this,{itemDragStart:"onItemDragStart",itemDrop:"onItemDropOrDragEnd",itemDragEnd:"onItemDropOrDragEnd"}),Array.isArray(b.items)&&this.addItems(b.items),this.$element.addClass("oo-ui-draggableGroupElement").attr("role","listbox").append(this.$status).toggleClass("oo-ui-draggableGroupElement-horizontal","horizontal"===this.orientation)},a.mixinClass(a.ui.mixin.DraggableGroupElement,a.ui.mixin.GroupElement),a.ui.mixin.DraggableGroupElement.prototype.onItemDragStart=function(a){this.itemsOrder=this.items.slice(),this.updateIndexes(),"horizontal"===this.orientation&&(this.dir=this.$element.css("direction")),this.setDragItem(a)},a.ui.mixin.DraggableGroupElement.prototype.updateIndexes=function(){var a,b;for(a=0,b=this.itemsOrder.length;a<b;a++)this.itemsOrder[a].setIndex(a)},a.ui.mixin.DraggableGroupElement.prototype.onItemDropOrDragEnd=function(){var a,b,c=this.getDragItem();return c&&(b=this.items.indexOf(c),a=c.getIndex()+(c.getIndex()>b?1:0),a!==b&&(this.reorder(this.getDragItem(),a),this.emit("reorder",this.getDragItem(),a)),this.updateIndexes()),this.unsetDragItem(),!1},a.ui.mixin.DraggableGroupElement.prototype.onDragOver=function(a){var b,c,d=this.getDragItem(),e=d.getIndex();b=$(a.target).closest(".oo-ui-draggableElement").data("index"),void 0!==b&&b!==e&&(c=b+(b>e?1:0),c>0?this.$group.children().eq(c-1).after(d.$element):this.$group.prepend(d.$element),this.itemsOrder.splice(b,0,this.itemsOrder.splice(e,1)[0]),this.updateIndexes(),this.emit("drag",d,c)),a.preventDefault()},a.ui.mixin.DraggableGroupElement.prototype.reorder=function(a,b){this.addItems([a],b)},a.ui.mixin.DraggableGroupElement.prototype.setDragItem=function(a){this.dragItem!==a&&(this.dragItem=a,this.$element.on("dragover",this.onDragOver.bind(this)),this.$element.addClass("oo-ui-draggableGroupElement-dragging"))},a.ui.mixin.DraggableGroupElement.prototype.unsetDragItem=function(){this.dragItem&&(this.dragItem=null,this.$element.off("dragover"),this.$element.removeClass("oo-ui-draggableGroupElement-dragging"))},a.ui.mixin.DraggableGroupElement.prototype.getDragItem=function(){return this.dragItem},a.ui.mixin.RequestManager=function(){this.requestCache={},this.requestQuery=null,this.requestRequest=null},a.initClass(a.ui.mixin.RequestManager),a.ui.mixin.RequestManager.prototype.getRequestData=function(){var a,b=this,c=this.getRequestQuery(),d=$.Deferred();return this.abortRequest(),Object.prototype.hasOwnProperty.call(this.requestCache,c)?d.resolve(this.requestCache[c]):(this.pushPending&&this.pushPending(),this.requestQuery=c,a=this.requestRequest=this.getRequest(),a.always(function(){b.popPending&&b.popPending()}).done(function(e){a===b.requestRequest&&(b.requestQuery=null,b.requestRequest=null,b.requestCache[c]=b.getRequestCacheDataFromResponse(e),d.resolve(b.requestCache[c]))}).fail(function(){a===b.requestRequest&&(b.requestQuery=null,b.requestRequest=null,d.reject())})),d.promise()},a.ui.mixin.RequestManager.prototype.abortRequest=function(){var a=this.requestRequest;a&&(this.requestRequest=null,this.requestQuery=null,a.abort())},a.ui.mixin.RequestManager.prototype.getRequestQuery=null,a.ui.mixin.RequestManager.prototype.getRequest=null,a.ui.mixin.RequestManager.prototype.getRequestCacheDataFromResponse=null,a.ui.mixin.LookupElement=function(b){b=$.extend({highlightFirst:!0},b),a.ui.mixin.RequestManager.call(this,b),this.$overlay=b.$overlay||this.$element,this.lookupMenu=new a.ui.FloatingMenuSelectWidget({widget:this,input:this,$container:b.$container||this.$element}),this.allowSuggestionsWhenEmpty=b.allowSuggestionsWhenEmpty||!1,this.lookupsDisabled=!1,this.lookupInputFocused=!1,this.lookupHighlightFirstItem=b.highlightFirst,this.$input.on({focus:this.onLookupInputFocus.bind(this),blur:this.onLookupInputBlur.bind(this),mousedown:this.onLookupInputMouseDown.bind(this)}),this.connect(this,{change:"onLookupInputChange"}),this.lookupMenu.connect(this,{toggle:"onLookupMenuToggle",choose:"onLookupMenuItemChoose"}),this.$element.addClass("oo-ui-lookupElement"),this.lookupMenu.$element.addClass("oo-ui-lookupElement-menu"),this.$overlay.append(this.lookupMenu.$element)},a.mixinClass(a.ui.mixin.LookupElement,a.ui.mixin.RequestManager),a.ui.mixin.LookupElement.prototype.onLookupInputFocus=function(){this.lookupInputFocused=!0,this.populateLookupMenu()},a.ui.mixin.LookupElement.prototype.onLookupInputBlur=function(){this.closeLookupMenu(),this.lookupInputFocused=!1},a.ui.mixin.LookupElement.prototype.onLookupInputMouseDown=function(){this.lookupInputFocused&&!this.lookupMenu.isVisible()&&this.populateLookupMenu()},a.ui.mixin.LookupElement.prototype.onLookupInputChange=function(){this.lookupInputFocused&&this.populateLookupMenu()},a.ui.mixin.LookupElement.prototype.onLookupMenuToggle=function(a){a||(this.abortLookupRequest(),this.lookupMenu.clearItems())},a.ui.mixin.LookupElement.prototype.onLookupMenuItemChoose=function(a){this.setValue(a.getData())},a.ui.mixin.LookupElement.prototype.getLookupMenu=function(){return this.lookupMenu},a.ui.mixin.LookupElement.prototype.setLookupsDisabled=function(a){this.lookupsDisabled=!!a},a.ui.mixin.LookupElement.prototype.openLookupMenu=function(){return this.lookupMenu.isEmpty()||this.lookupMenu.toggle(!0),this},a.ui.mixin.LookupElement.prototype.closeLookupMenu=function(){return this.lookupMenu.toggle(!1),this.abortLookupRequest(),this.lookupMenu.clearItems(),this},a.ui.mixin.LookupElement.prototype.populateLookupMenu=function(){var a=this,b=this.getValue();if(!this.lookupsDisabled&&!this.isReadOnly())return this.allowSuggestionsWhenEmpty||""!==b?b!==this.lookupQuery&&this.getLookupMenuItems().done(function(b){a.lookupMenu.clearItems(),b.length?(a.lookupMenu.addItems(b).toggle(!0),a.initializeLookupMenuSelection()):a.lookupMenu.toggle(!1)}).fail(function(){a.lookupMenu.clearItems()}):this.closeLookupMenu(),this},a.ui.mixin.LookupElement.prototype.initializeLookupMenuSelection=function(){this.lookupHighlightFirstItem&&!this.lookupMenu.getSelectedItem()&&this.lookupMenu.highlightItem(this.lookupMenu.getFirstSelectableItem())},a.ui.mixin.LookupElement.prototype.getLookupMenuItems=function(){return this.getRequestData().then(function(a){return this.getLookupMenuOptionsFromData(a)}.bind(this))},a.ui.mixin.LookupElement.prototype.abortLookupRequest=function(){this.abortRequest()},a.ui.mixin.LookupElement.prototype.getLookupRequest=null,a.ui.mixin.LookupElement.prototype.getLookupCacheDataFromResponse=null,a.ui.mixin.LookupElement.prototype.getLookupMenuOptionsFromData=null,a.ui.mixin.LookupElement.prototype.setReadOnly=function(b){return a.ui.TextInputWidget.prototype.setReadOnly.call(this,b),this.isReadOnly()&&this.lookupMenu&&this.closeLookupMenu(),this},a.ui.mixin.LookupElement.prototype.getRequestQuery=function(){return this.getValue()},a.ui.mixin.LookupElement.prototype.getRequest=function(){return this.getLookupRequest()},a.ui.mixin.LookupElement.prototype.getRequestCacheDataFromResponse=function(a){return this.getLookupCacheDataFromResponse(a)},a.ui.CardLayout=function(b,c){a.isPlainObject(b)&&void 0===c&&(c=b,b=c.name),c=$.extend({scrollable:!0},c),a.ui.CardLayout.parent.call(this,c),this.name=b,this.label=c.label,this.tabItem=null,this.active=!1,this.$element.addClass("oo-ui-cardLayout")},a.inheritClass(a.ui.CardLayout,a.ui.PanelLayout),a.ui.CardLayout.prototype.getName=function(){return this.name},a.ui.CardLayout.prototype.isActive=function(){return this.active},a.ui.CardLayout.prototype.getTabItem=function(){return this.tabItem},a.ui.CardLayout.prototype.setTabItem=function(a){return this.tabItem=a||null,a&&this.setupTabItem(),this},a.ui.CardLayout.prototype.setupTabItem=function(){return this.label&&this.tabItem.setLabel(this.label),this},a.ui.CardLayout.prototype.setActive=function(a){a=!!a,a!==this.active&&(this.active=a,this.$element.toggleClass("oo-ui-cardLayout-active",this.active),this.emit("active",this.active))},a.ui.PageLayout=function(b,c){a.isPlainObject(b)&&void 0===c&&(c=b,b=c.name),c=$.extend({scrollable:!0},c),a.ui.PageLayout.parent.call(this,c),this.name=b,this.outlineItem=null,this.active=!1,this.$element.addClass("oo-ui-pageLayout")},a.inheritClass(a.ui.PageLayout,a.ui.PanelLayout),a.ui.PageLayout.prototype.getName=function(){return this.name},a.ui.PageLayout.prototype.isActive=function(){return this.active},a.ui.PageLayout.prototype.getOutlineItem=function(){return this.outlineItem},a.ui.PageLayout.prototype.setOutlineItem=function(a){return this.outlineItem=a||null,a&&this.setupOutlineItem(),this},a.ui.PageLayout.prototype.setupOutlineItem=function(){return this},a.ui.PageLayout.prototype.setActive=function(a){a=!!a,a!==this.active&&(this.active=a,this.$element.toggleClass("oo-ui-pageLayout-active",a),this.emit("active",this.active))},a.ui.StackLayout=function(b){b=$.extend({scrollable:!0},b),a.ui.StackLayout.parent.call(this,b),a.ui.mixin.GroupElement.call(this,$.extend({},b,{$group:this.$element})),this.currentItem=null,this.continuous=!!b.continuous,this.$element.addClass("oo-ui-stackLayout"),this.continuous&&(this.$element.addClass("oo-ui-stackLayout-continuous"),this.$element.on("scroll",a.ui.debounce(this.onScroll.bind(this),250))),Array.isArray(b.items)&&this.addItems(b.items)},a.inheritClass(a.ui.StackLayout,a.ui.PanelLayout),a.mixinClass(a.ui.StackLayout,a.ui.mixin.GroupElement),a.ui.StackLayout.prototype.onScroll=function(){function a(a){return a.$element[0].getBoundingClientRect()}function b(b){var c=a(b);return c.bottom>g.top&&c.top<g.bottom}var c,d=this.items.length,e=this.items.indexOf(this.currentItem),f=e,g=this.$element[0].getBoundingClientRect();if(g&&(g.top||g.bottom)){if(c=a(this.currentItem),c.bottom<g.top)for(;++f<d&&!b(this.items[f]););else if(c.top>g.bottom)for(;--f>=0&&!b(this.items[f]););f!==e&&this.emit("visibleItemChange",this.items[f])}},a.ui.StackLayout.prototype.getCurrentItem=function(){return this.currentItem},a.ui.StackLayout.prototype.unsetCurrentItem=function(){var a=this.currentItem;null!==a&&(this.currentItem=null,this.emit("set",null))},a.ui.StackLayout.prototype.addItems=function(b,c){return this.updateHiddenState(b,this.currentItem),a.ui.mixin.GroupElement.prototype.addItems.call(this,b,c),!this.currentItem&&b.length&&this.setItem(b[0]),this},a.ui.StackLayout.prototype.removeItems=function(b){return a.ui.mixin.GroupElement.prototype.removeItems.call(this,b),b.indexOf(this.currentItem)!==-1&&(this.items.length?this.setItem(this.items[0]):this.unsetCurrentItem()),this},a.ui.StackLayout.prototype.clearItems=function(){return this.unsetCurrentItem(),a.ui.mixin.GroupElement.prototype.clearItems.call(this),this},a.ui.StackLayout.prototype.setItem=function(a){return a!==this.currentItem&&(this.updateHiddenState(this.items,a),this.items.indexOf(a)!==-1?(this.currentItem=a,this.emit("set",a)):this.unsetCurrentItem()),this},a.ui.StackLayout.prototype.updateHiddenState=function(a,b){var c,d;if(!this.continuous){for(c=0,d=a.length;c<d;c++)b&&b===a[c]||(a[c].$element.addClass("oo-ui-element-hidden"),a[c].$element.attr("aria-hidden","true"));b&&(b.$element.removeClass("oo-ui-element-hidden"),b.$element.removeAttr("aria-hidden"))}},a.ui.MenuLayout=function(b){b=$.extend({showMenu:!0,menuPosition:"before"},b),a.ui.MenuLayout.parent.call(this,b),this.$menu=$("<div>"),this.$content=$("<div>"),this.$menu.addClass("oo-ui-menuLayout-menu"),this.$content.addClass("oo-ui-menuLayout-content"),this.$element.addClass("oo-ui-menuLayout").append(this.$content,this.$menu),this.setMenuPosition(b.menuPosition),this.toggleMenu(b.showMenu)},a.inheritClass(a.ui.MenuLayout,a.ui.Layout),a.ui.MenuLayout.prototype.toggleMenu=function(a){return a=void 0===a?!this.showMenu:!!a,this.showMenu!==a&&(this.showMenu=a,this.$element.toggleClass("oo-ui-menuLayout-showMenu",this.showMenu).toggleClass("oo-ui-menuLayout-hideMenu",!this.showMenu),this.$menu.attr("aria-hidden",this.showMenu?"false":"true")),this},a.ui.MenuLayout.prototype.isMenuVisible=function(){return this.showMenu},a.ui.MenuLayout.prototype.setMenuPosition=function(a){return this.$element.removeClass("oo-ui-menuLayout-"+this.menuPosition),this.menuPosition=a,this.$element.addClass("oo-ui-menuLayout-"+a),this},a.ui.MenuLayout.prototype.getMenuPosition=function(){return this.menuPosition},a.ui.BookletLayout=function(b){b=b||{},a.ui.BookletLayout.parent.call(this,b),this.currentPageName=null,this.pages={},this.ignoreFocus=!1,this.stackLayout=new a.ui.StackLayout({continuous:!!b.continuous}),this.$content.append(this.stackLayout.$element),this.autoFocus=void 0===b.autoFocus||!!b.autoFocus,this.outlineVisible=!1,this.outlined=!!b.outlined,this.outlined&&(this.editable=!!b.editable,this.outlineControlsWidget=null,this.outlineSelectWidget=new a.ui.OutlineSelectWidget,this.outlinePanel=new a.ui.PanelLayout({scrollable:!0}),this.$menu.append(this.outlinePanel.$element),this.outlineVisible=!0,this.editable&&(this.outlineControlsWidget=new a.ui.OutlineControlsWidget(this.outlineSelectWidget))),this.toggleMenu(this.outlined),this.stackLayout.connect(this,{set:"onStackLayoutSet"}),this.outlined&&(this.outlineSelectWidget.connect(this,{select:"onOutlineSelectWidgetSelect"}),this.scrolling=!1,this.stackLayout.connect(this,{visibleItemChange:"onStackLayoutVisibleItemChange"})),this.autoFocus&&this.stackLayout.$element.on("focusin",this.onStackLayoutFocus.bind(this)),this.$element.addClass("oo-ui-bookletLayout"),this.stackLayout.$element.addClass("oo-ui-bookletLayout-stackLayout"),this.outlined&&(this.outlinePanel.$element.addClass("oo-ui-bookletLayout-outlinePanel").append(this.outlineSelectWidget.$element),this.editable&&this.outlinePanel.$element.addClass("oo-ui-bookletLayout-outlinePanel-editable").append(this.outlineControlsWidget.$element))},a.inheritClass(a.ui.BookletLayout,a.ui.MenuLayout),a.ui.BookletLayout.prototype.onStackLayoutFocus=function(a){var b,c;c=$(a.target).closest(".oo-ui-pageLayout");for(b in this.pages)if(this.pages[b].$element[0]===c[0]&&b!==this.currentPageName){this.setPage(b);break}},a.ui.BookletLayout.prototype.onStackLayoutVisibleItemChange=function(a){this.scrolling=!0,this.outlineSelectWidget.selectItemByData(a.getName()),this.scrolling=!1},a.ui.BookletLayout.prototype.onStackLayoutSet=function(b){var c=this;!this.scrolling&&b&&b.scrollElementIntoView().done(function(){c.autoFocus&&!a.ui.isMobile()&&c.focus()})},a.ui.BookletLayout.prototype.focus=function(b){var c,d=this.stackLayout.getItems();c=void 0!==b&&d[b]?d[b]:this.stackLayout.getCurrentItem(),!c&&this.outlined&&(this.selectFirstSelectablePage(),c=this.stackLayout.getCurrentItem()),c&&(a.ui.contains(c.$element[0],this.getElementDocument().activeElement,!0)||c.focus())},a.ui.BookletLayout.prototype.focusFirstFocusable=function(){a.ui.findFocusable(this.stackLayout.$element).focus()},a.ui.BookletLayout.prototype.onOutlineSelectWidgetSelect=function(a){a&&this.setPage(a.getData())},a.ui.BookletLayout.prototype.isOutlined=function(){return this.outlined},a.ui.BookletLayout.prototype.isEditable=function(){return this.editable},a.ui.BookletLayout.prototype.isOutlineVisible=function(){return this.outlined&&this.outlineVisible},a.ui.BookletLayout.prototype.toggleOutline=function(a){return this.outlined&&(a=void 0===a?!this.outlineVisible:!!a,this.outlineVisible=a,this.toggleMenu(a)),this},a.ui.BookletLayout.prototype.getClosestPage=function(a){var b,c,d,e=this.stackLayout.getItems(),f=e.indexOf(a);if(f!==-1&&(b=e[f+1],c=e[f-1],this.outlined)){if(d=this.outlineSelectWidget.getItemFromData(a.getName()).getLevel(),c&&d===this.outlineSelectWidget.getItemFromData(c.getName()).getLevel())return c;if(b&&d===this.outlineSelectWidget.getItemFromData(b.getName()).getLevel())return b}return c||b||null},a.ui.BookletLayout.prototype.getOutline=function(){return this.outlineSelectWidget},a.ui.BookletLayout.prototype.getOutlineControls=function(){return this.outlineControlsWidget},a.ui.BookletLayout.prototype.getPage=function(a){return this.pages[a]},a.ui.BookletLayout.prototype.getCurrentPage=function(){var a=this.getCurrentPageName();return a?this.getPage(a):void 0},a.ui.BookletLayout.prototype.getCurrentPageName=function(){return this.currentPageName},a.ui.BookletLayout.prototype.addPages=function(b,c){var d,e,f,g,h,i,j=this.stackLayout.getItems(),k=[],l=[];for(d=0,e=b.length;d<e;d++)g=b[d],f=g.getName(),Object.prototype.hasOwnProperty.call(this.pages,f)&&(i=j.indexOf(this.pages[f]),i!==-1&&i+1<c&&c--,k.push(this.pages[f]));for(k.length&&this.removePages(k),d=0,e=b.length;d<e;d++)g=b[d],f=g.getName(),this.pages[g.getName()]=g,this.outlined&&(h=new a.ui.OutlineOptionWidget({data:f}),g.setOutlineItem(h),l.push(h));return this.outlined&&l.length&&(this.outlineSelectWidget.addItems(l,c),this.selectFirstSelectablePage()),this.stackLayout.addItems(b,c),this.emit("add",b,c),this},a.ui.BookletLayout.prototype.removePages=function(a){var b,c,d,e,f=[];for(b=0,c=a.length;b<c;b++)e=a[b],d=e.getName(),delete this.pages[d],this.outlined&&(f.push(this.outlineSelectWidget.getItemFromData(d)),e.setOutlineItem(null));return this.outlined&&f.length&&(this.outlineSelectWidget.removeItems(f),this.selectFirstSelectablePage()),this.stackLayout.removeItems(a),this.emit("remove",a),this},a.ui.BookletLayout.prototype.clearPages=function(){var a,b,c=this.stackLayout.getItems();if(this.pages={},this.currentPageName=null,this.outlined)for(this.outlineSelectWidget.clearItems(),a=0,b=c.length;a<b;a++)c[a].setOutlineItem(null);return this.stackLayout.clearItems(),this.emit("remove",c),this},a.ui.BookletLayout.prototype.setPage=function(b){var c,d,e=this.pages[b],f=this.currentPageName&&this.pages[this.currentPageName];b!==this.currentPageName&&(this.outlined&&(c=this.outlineSelectWidget.getSelectedItem(),c&&c.getData()!==b&&this.outlineSelectWidget.selectItemByData(b)),e&&(f&&(f.setActive(!1),this.autoFocus&&!a.ui.isMobile()&&this.stackLayout.continuous&&0!==a.ui.findFocusable(e.$element).length&&(d=f.$element.find(":focus"),d.length&&d[0].blur())),this.currentPageName=b,e.setActive(!0),this.stackLayout.setItem(e),!this.stackLayout.continuous&&f&&(d=f.$element.find(":focus"),d.length&&d[0].blur()),this.emit("set",e)))},a.ui.BookletLayout.prototype.selectFirstSelectablePage=function(){return this.outlineSelectWidget.getSelectedItem()||this.outlineSelectWidget.selectItem(this.outlineSelectWidget.getFirstSelectableItem()),this},a.ui.IndexLayout=function(b){b=$.extend({},b,{menuPosition:"top"}),a.ui.IndexLayout.parent.call(this,b),this.currentCardName=null,this.cards={},this.ignoreFocus=!1,this.stackLayout=new a.ui.StackLayout({continuous:!!b.continuous,expanded:b.expanded}),this.$content.append(this.stackLayout.$element),this.autoFocus=void 0===b.autoFocus||!!b.autoFocus,this.tabSelectWidget=new a.ui.TabSelectWidget,this.tabPanel=new a.ui.PanelLayout,this.$menu.append(this.tabPanel.$element),this.toggleMenu(!0),this.stackLayout.connect(this,{set:"onStackLayoutSet"}),this.tabSelectWidget.connect(this,{select:"onTabSelectWidgetSelect"}),this.autoFocus&&this.stackLayout.$element.on("focusin",this.onStackLayoutFocus.bind(this)),this.$element.addClass("oo-ui-indexLayout"),this.stackLayout.$element.addClass("oo-ui-indexLayout-stackLayout"),this.tabPanel.$element.addClass("oo-ui-indexLayout-tabPanel").append(this.tabSelectWidget.$element)},a.inheritClass(a.ui.IndexLayout,a.ui.MenuLayout),a.ui.IndexLayout.prototype.onStackLayoutFocus=function(a){var b,c;c=$(a.target).closest(".oo-ui-cardLayout");for(b in this.cards)if(this.cards[b].$element[0]===c[0]&&b!==this.currentCardName){this.setCard(b);break}},a.ui.IndexLayout.prototype.onStackLayoutSet=function(b){var c=this;b&&b.scrollElementIntoView().done(function(){c.autoFocus&&!a.ui.isMobile()&&c.focus()})},a.ui.IndexLayout.prototype.focus=function(b){var c,d=this.stackLayout.getItems();c=void 0!==b&&d[b]?d[b]:this.stackLayout.getCurrentItem(),c||(this.selectFirstSelectableCard(),c=this.stackLayout.getCurrentItem()),c&&(a.ui.contains(c.$element[0],this.getElementDocument().activeElement,!0)||c.focus())},a.ui.IndexLayout.prototype.focusFirstFocusable=function(){a.ui.findFocusable(this.stackLayout.$element).focus()},a.ui.IndexLayout.prototype.onTabSelectWidgetSelect=function(a){a&&this.setCard(a.getData())},a.ui.IndexLayout.prototype.getClosestCard=function(a){var b,c,d,e=this.stackLayout.getItems(),f=e.indexOf(a);if(f!==-1){if(b=e[f+1],c=e[f-1],d=this.tabSelectWidget.getItemFromData(a.getName()).getLevel(),c&&d===this.tabSelectWidget.getItemFromData(c.getName()).getLevel())return c;if(b&&d===this.tabSelectWidget.getItemFromData(b.getName()).getLevel())return b}return c||b||null},a.ui.IndexLayout.prototype.getTabs=function(){return this.tabSelectWidget},a.ui.IndexLayout.prototype.getCard=function(a){return this.cards[a]},a.ui.IndexLayout.prototype.getCurrentCard=function(){var a=this.getCurrentCardName();return a?this.getCard(a):void 0},a.ui.IndexLayout.prototype.getCurrentCardName=function(){return this.currentCardName},a.ui.IndexLayout.prototype.addCards=function(b,c){var d,e,f,g,h,i,j=this.stackLayout.getItems(),k=[],l=[];for(d=0,e=b.length;d<e;d++)g=b[d],f=g.getName(),Object.prototype.hasOwnProperty.call(this.cards,f)&&(i=j.indexOf(this.cards[f]),i!==-1&&i+1<c&&c--,k.push(this.cards[f]));for(k.length&&this.removeCards(k),d=0,e=b.length;d<e;d++)g=b[d],f=g.getName(),this.cards[g.getName()]=g,h=new a.ui.TabOptionWidget({data:f}),g.setTabItem(h),l.push(h);return l.length&&(this.tabSelectWidget.addItems(l,c),this.selectFirstSelectableCard()),this.stackLayout.addItems(b,c),this.emit("add",b,c),this},a.ui.IndexLayout.prototype.removeCards=function(a){var b,c,d,e,f=[];for(b=0,c=a.length;b<c;b++)e=a[b],d=e.getName(),delete this.cards[d],f.push(this.tabSelectWidget.getItemFromData(d)),e.setTabItem(null);return f.length&&(this.tabSelectWidget.removeItems(f),this.selectFirstSelectableCard()),this.stackLayout.removeItems(a),this.emit("remove",a),this},a.ui.IndexLayout.prototype.clearCards=function(){var a,b,c=this.stackLayout.getItems();for(this.cards={},this.currentCardName=null,this.tabSelectWidget.clearItems(),a=0,b=c.length;a<b;a++)c[a].setTabItem(null);return this.stackLayout.clearItems(),this.emit("remove",c),this},a.ui.IndexLayout.prototype.setCard=function(b){var c,d,e=this.cards[b],f=this.currentCardName&&this.cards[this.currentCardName];b!==this.currentCardName&&(c=this.tabSelectWidget.getSelectedItem(),c&&c.getData()!==b&&this.tabSelectWidget.selectItemByData(b),e&&(f&&(f.setActive(!1),this.autoFocus&&!a.ui.isMobile()&&this.stackLayout.continuous&&0!==a.ui.findFocusable(e.$element).length&&(d=f.$element.find(":focus"),d.length&&d[0].blur())),this.currentCardName=b,e.setActive(!0),this.stackLayout.setItem(e),!this.stackLayout.continuous&&f&&(d=f.$element.find(":focus"),d.length&&d[0].blur()),this.emit("set",e)))},a.ui.IndexLayout.prototype.selectFirstSelectableCard=function(){return this.tabSelectWidget.getSelectedItem()||this.tabSelectWidget.selectItem(this.tabSelectWidget.getFirstSelectableItem()),this},a.ui.ToggleWidget=function(b){b=b||{},a.ui.ToggleWidget.parent.call(this,b),this.value=null,this.$element.addClass("oo-ui-toggleWidget"),this.setValue(!!b.value)},a.inheritClass(a.ui.ToggleWidget,a.ui.Widget),a.ui.ToggleWidget.prototype.getValue=function(){return this.value},a.ui.ToggleWidget.prototype.setValue=function(a){return a=!!a,this.value!==a&&(this.value=a,this.emit("change",a),this.$element.toggleClass("oo-ui-toggleWidget-on",a),this.$element.toggleClass("oo-ui-toggleWidget-off",!a),this.$element.attr("aria-checked",a.toString())),this},a.ui.ToggleButtonWidget=function(b){b=b||{},a.ui.ToggleButtonWidget.parent.call(this,b),a.ui.mixin.ButtonElement.call(this,$.extend({},b,{active:this.active})),a.ui.mixin.IconElement.call(this,b),a.ui.mixin.IndicatorElement.call(this,b),a.ui.mixin.LabelElement.call(this,b),a.ui.mixin.TitledElement.call(this,$.extend({},b,{$titled:this.$button})),a.ui.mixin.FlaggedElement.call(this,b),a.ui.mixin.TabIndexedElement.call(this,$.extend({},b,{$tabIndexed:this.$button})),this.connect(this,{click:"onAction"}),this.$button.append(this.$icon,this.$label,this.$indicator),this.$element.addClass("oo-ui-toggleButtonWidget").append(this.$button)},a.inheritClass(a.ui.ToggleButtonWidget,a.ui.ToggleWidget),a.mixinClass(a.ui.ToggleButtonWidget,a.ui.mixin.ButtonElement),a.mixinClass(a.ui.ToggleButtonWidget,a.ui.mixin.IconElement),a.mixinClass(a.ui.ToggleButtonWidget,a.ui.mixin.IndicatorElement),a.mixinClass(a.ui.ToggleButtonWidget,a.ui.mixin.LabelElement),a.mixinClass(a.ui.ToggleButtonWidget,a.ui.mixin.TitledElement),a.mixinClass(a.ui.ToggleButtonWidget,a.ui.mixin.FlaggedElement),a.mixinClass(a.ui.ToggleButtonWidget,a.ui.mixin.TabIndexedElement),a.ui.ToggleButtonWidget.prototype.onAction=function(){this.setValue(!this.value)},a.ui.ToggleButtonWidget.prototype.setValue=function(b){return b=!!b,b!==this.value&&(this.$button&&this.$button.attr("aria-pressed",b.toString()),this.setActive(b)),a.ui.ToggleButtonWidget.parent.prototype.setValue.call(this,b),this},a.ui.ToggleButtonWidget.prototype.setButtonElement=function(b){this.$button&&this.$button.removeAttr("aria-pressed"),a.ui.mixin.ButtonElement.prototype.setButtonElement.call(this,b),this.$button.attr("aria-pressed",this.value.toString())},a.ui.ToggleSwitchWidget=function(b){a.ui.ToggleSwitchWidget.parent.call(this,b),a.ui.mixin.TabIndexedElement.call(this,b),this.dragging=!1,this.dragStart=null,this.sliding=!1,this.$glow=$("<span>"),this.$grip=$("<span>"),this.$element.on({click:this.onClick.bind(this),keypress:this.onKeyPress.bind(this)}),this.$glow.addClass("oo-ui-toggleSwitchWidget-glow"),this.$grip.addClass("oo-ui-toggleSwitchWidget-grip"),this.$element.addClass("oo-ui-toggleSwitchWidget").attr("role","checkbox").append(this.$glow,this.$grip)},a.inheritClass(a.ui.ToggleSwitchWidget,a.ui.ToggleWidget),a.mixinClass(a.ui.ToggleSwitchWidget,a.ui.mixin.TabIndexedElement),a.ui.ToggleSwitchWidget.prototype.onClick=function(b){return this.isDisabled()||b.which!==a.ui.MouseButtons.LEFT||this.setValue(!this.value),!1},a.ui.ToggleSwitchWidget.prototype.onKeyPress=function(b){if(!this.isDisabled()&&(b.which===a.ui.Keys.SPACE||b.which===a.ui.Keys.ENTER))return this.setValue(!this.value),!1},a.ui.OutlineControlsWidget=function(b,c){a.isPlainObject(b)&&void 0===c&&(c=b,b=c.outline),c=$.extend({icon:"add"},c),a.ui.OutlineControlsWidget.parent.call(this,c),a.ui.mixin.GroupElement.call(this,c),a.ui.mixin.IconElement.call(this,c),this.outline=b,this.$movers=$("<div>"),this.upButton=new a.ui.ButtonWidget({framed:!1,icon:"collapse",title:a.ui.msg("ooui-outline-control-move-up")}),this.downButton=new a.ui.ButtonWidget({framed:!1,icon:"expand",title:a.ui.msg("ooui-outline-control-move-down")}),this.removeButton=new a.ui.ButtonWidget({framed:!1,icon:"remove",title:a.ui.msg("ooui-outline-control-remove")}),this.abilities={move:!0,remove:!0},b.connect(this,{select:"onOutlineChange",add:"onOutlineChange",remove:"onOutlineChange"}),this.upButton.connect(this,{click:["emit","move",-1]}),this.downButton.connect(this,{click:["emit","move",1]}),this.removeButton.connect(this,{click:["emit","remove"]}),this.$element.addClass("oo-ui-outlineControlsWidget"),this.$group.addClass("oo-ui-outlineControlsWidget-items"),this.$movers.addClass("oo-ui-outlineControlsWidget-movers").append(this.removeButton.$element,this.upButton.$element,this.downButton.$element),this.$element.append(this.$icon,this.$group,this.$movers),this.setAbilities(c.abilities||{})},a.inheritClass(a.ui.OutlineControlsWidget,a.ui.Widget),a.mixinClass(a.ui.OutlineControlsWidget,a.ui.mixin.GroupElement),a.mixinClass(a.ui.OutlineControlsWidget,a.ui.mixin.IconElement),a.ui.OutlineControlsWidget.prototype.setAbilities=function(a){var b;for(b in this.abilities)void 0!==a[b]&&(this.abilities[b]=!!a[b]);this.onOutlineChange()},a.ui.OutlineControlsWidget.prototype.onOutlineChange=function(){var a,b,c,d,e=this.outline.getItems(),f=this.outline.getSelectedItem(),g=this.abilities.move&&f&&f.isMovable(),h=this.abilities.remove&&f&&f.isRemovable();if(g){for(a=-1,b=e.length;++a<b;)if(e[a].isMovable()){c=e[a];break}for(a=b;a--;)if(e[a].isMovable()){d=e[a];break}}this.upButton.setDisabled(!g||f===c),this.downButton.setDisabled(!g||f===d),this.removeButton.setDisabled(!h)},a.ui.OutlineOptionWidget=function(b){b=b||{},a.ui.OutlineOptionWidget.parent.call(this,b),this.level=0,this.movable=!!b.movable,this.removable=!!b.removable,this.$element.addClass("oo-ui-outlineOptionWidget"),this.setLevel(b.level)},a.inheritClass(a.ui.OutlineOptionWidget,a.ui.DecoratedOptionWidget),a.ui.OutlineOptionWidget.static.highlightable=!0,a.ui.OutlineOptionWidget.static.scrollIntoViewOnSelect=!0,a.ui.OutlineOptionWidget.static.levelClass="oo-ui-outlineOptionWidget-level-",a.ui.OutlineOptionWidget.static.levels=3,a.ui.OutlineOptionWidget.prototype.isMovable=function(){return this.movable},a.ui.OutlineOptionWidget.prototype.isRemovable=function(){return this.removable},a.ui.OutlineOptionWidget.prototype.getLevel=function(){return this.level},a.ui.OutlineOptionWidget.prototype.setPressed=function(b){return a.ui.OutlineOptionWidget.parent.prototype.setPressed.call(this,b),this.pressed?this.setFlags({progressive:!0}):this.selected||this.setFlags({progressive:!1}),this},a.ui.OutlineOptionWidget.prototype.setMovable=function(a){return this.movable=!!a,this.updateThemeClasses(),this},a.ui.OutlineOptionWidget.prototype.setRemovable=function(a){return this.removable=!!a,this.updateThemeClasses(),this},a.ui.OutlineOptionWidget.prototype.setSelected=function(b){return a.ui.OutlineOptionWidget.parent.prototype.setSelected.call(this,b),this.selected?this.setFlags({progressive:!0}):this.setFlags({progressive:!1}),this},a.ui.OutlineOptionWidget.prototype.setLevel=function(a){var b=this.constructor.static.levels,c=this.constructor.static.levelClass,d=b;for(this.level=a?Math.max(0,Math.min(b-1,a)):0;d--;)this.level===d?this.$element.addClass(c+d):this.$element.removeClass(c+d);return this.updateThemeClasses(),this},a.ui.OutlineSelectWidget=function(b){a.ui.OutlineSelectWidget.parent.call(this,b),a.ui.mixin.TabIndexedElement.call(this,b),
this.$element.on({focus:this.bindKeyDownListener.bind(this),blur:this.unbindKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-outlineSelectWidget")},a.inheritClass(a.ui.OutlineSelectWidget,a.ui.SelectWidget),a.mixinClass(a.ui.OutlineSelectWidget,a.ui.mixin.TabIndexedElement),a.ui.ButtonOptionWidget=function(b){b=b||{},a.ui.ButtonOptionWidget.parent.call(this,b),a.ui.mixin.ButtonElement.call(this,b),a.ui.mixin.IconElement.call(this,b),a.ui.mixin.IndicatorElement.call(this,b),a.ui.mixin.TitledElement.call(this,$.extend({},b,{$titled:this.$button})),this.$element.addClass("oo-ui-buttonOptionWidget"),this.$button.append(this.$icon,this.$label,this.$indicator),this.$element.append(this.$button)},a.inheritClass(a.ui.ButtonOptionWidget,a.ui.OptionWidget),a.mixinClass(a.ui.ButtonOptionWidget,a.ui.mixin.ButtonElement),a.mixinClass(a.ui.ButtonOptionWidget,a.ui.mixin.IconElement),a.mixinClass(a.ui.ButtonOptionWidget,a.ui.mixin.IndicatorElement),a.mixinClass(a.ui.ButtonOptionWidget,a.ui.mixin.TitledElement),a.ui.ButtonOptionWidget.static.cancelButtonMouseDownEvents=!1,a.ui.ButtonOptionWidget.static.highlightable=!1,a.ui.ButtonOptionWidget.prototype.setSelected=function(b){return a.ui.ButtonOptionWidget.parent.prototype.setSelected.call(this,b),this.constructor.static.selectable&&this.setActive(b),this},a.ui.ButtonSelectWidget=function(b){a.ui.ButtonSelectWidget.parent.call(this,b),a.ui.mixin.TabIndexedElement.call(this,b),this.$element.on({focus:this.bindKeyDownListener.bind(this),blur:this.unbindKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-buttonSelectWidget")},a.inheritClass(a.ui.ButtonSelectWidget,a.ui.SelectWidget),a.mixinClass(a.ui.ButtonSelectWidget,a.ui.mixin.TabIndexedElement),a.ui.TabOptionWidget=function(b){b=b||{},a.ui.TabOptionWidget.parent.call(this,b),this.$element.addClass("oo-ui-tabOptionWidget")},a.inheritClass(a.ui.TabOptionWidget,a.ui.OptionWidget),a.ui.TabOptionWidget.static.highlightable=!1,a.ui.TabSelectWidget=function(b){a.ui.TabSelectWidget.parent.call(this,b),a.ui.mixin.TabIndexedElement.call(this,b),this.$element.on({focus:this.bindKeyDownListener.bind(this),blur:this.unbindKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-tabSelectWidget")},a.inheritClass(a.ui.TabSelectWidget,a.ui.SelectWidget),a.mixinClass(a.ui.TabSelectWidget,a.ui.mixin.TabIndexedElement),a.ui.CapsuleItemWidget=function(b){b=b||{},a.ui.CapsuleItemWidget.parent.call(this,b),a.ui.mixin.ItemWidget.call(this),a.ui.mixin.LabelElement.call(this,b),a.ui.mixin.FlaggedElement.call(this,b),a.ui.mixin.TabIndexedElement.call(this,b),this.closeButton=new a.ui.ButtonWidget({framed:!1,indicator:"clear",tabIndex:-1}).on("click",this.onCloseClick.bind(this)),this.on("disable",function(a){this.closeButton.setDisabled(a)}.bind(this)),this.$element.on({click:this.onClick.bind(this),keydown:this.onKeyDown.bind(this)}).addClass("oo-ui-capsuleItemWidget").append(this.$label,this.closeButton.$element)},a.inheritClass(a.ui.CapsuleItemWidget,a.ui.Widget),a.mixinClass(a.ui.CapsuleItemWidget,a.ui.mixin.ItemWidget),a.mixinClass(a.ui.CapsuleItemWidget,a.ui.mixin.LabelElement),a.mixinClass(a.ui.CapsuleItemWidget,a.ui.mixin.FlaggedElement),a.mixinClass(a.ui.CapsuleItemWidget,a.ui.mixin.TabIndexedElement),a.ui.CapsuleItemWidget.prototype.onCloseClick=function(){var a=this.getElementGroup();a&&$.isFunction(a.removeItems)&&(a.removeItems([this]),a.focus())},a.ui.CapsuleItemWidget.prototype.onClick=function(){var a=this.getElementGroup();!this.isDisabled()&&a&&$.isFunction(a.editItem)&&a.editItem(this)},a.ui.CapsuleItemWidget.prototype.onKeyDown=function(b){var c=this.getElementGroup();return b.keyCode===a.ui.Keys.BACKSPACE||b.keyCode===a.ui.Keys.DELETE?(c.removeItems([this]),c.focus(),!1):b.keyCode===a.ui.Keys.ENTER?(c.editItem(this),!1):void(b.keyCode===a.ui.Keys.LEFT?c.getPreviousItem(this).focus():b.keyCode===a.ui.Keys.RIGHT&&c.getNextItem(this).focus())},a.ui.CapsuleItemWidget.prototype.focus=function(){this.$element.focus()},a.ui.CapsuleMultiselectWidget=function(b){var c;a.ui.CapsuleMultiselectWidget.parent.call(this,b),b=$.extend({allowArbitrary:!1,allowDuplicates:!1,$overlay:this.$element},b),this.$handle=$("<div>"),this.$input=b.popup?null:$("<input>"),void 0!==b.placeholder&&""!==b.placeholder&&this.$input.attr("placeholder",b.placeholder),a.ui.mixin.GroupElement.call(this,b),b.popup?(b.popup=$.extend({},b.popup,{align:"forwards",anchor:!1}),a.ui.mixin.PopupElement.call(this,b),c=$("<span>"),a.ui.mixin.TabIndexedElement.call(this,$.extend({},b,{$tabIndexed:c}))):(this.popup=null,c=null,a.ui.mixin.TabIndexedElement.call(this,$.extend({},b,{$tabIndexed:this.$input}))),a.ui.mixin.IndicatorElement.call(this,b),a.ui.mixin.IconElement.call(this,b),this.$content=$("<div>"),this.allowArbitrary=b.allowArbitrary,this.allowDuplicates=b.allowDuplicates,this.$overlay=b.$overlay,this.menu=new a.ui.FloatingMenuSelectWidget($.extend({widget:this,$input:this.$input,$container:this.$element,filterFromInput:!0,disabled:this.isDisabled()},b.menu)),this.popup?(c.on({focus:this.focus.bind(this)}),this.popup.$element.on("focusout",this.onPopupFocusOut.bind(this)),this.popup.$autoCloseIgnore&&this.popup.$autoCloseIgnore.on("focusout",this.onPopupFocusOut.bind(this)),this.popup.connect(this,{toggle:function(a){c.toggle(!a)}})):this.$input.on({focus:this.onInputFocus.bind(this),blur:this.onInputBlur.bind(this),"propertychange change click mouseup keydown keyup input cut paste select focus":a.ui.debounce(this.updateInputSize.bind(this)),keydown:this.onKeyDown.bind(this),keypress:this.onKeyPress.bind(this)}),this.menu.connect(this,{choose:"onMenuChoose",toggle:"onMenuToggle",add:"onMenuItemsChange",remove:"onMenuItemsChange"}),this.$handle.on({mousedown:this.onMouseDown.bind(this)}),this.$input&&(this.$input.prop("disabled",this.isDisabled()),this.$input.attr({role:"combobox","aria-autocomplete":"list"})),b.data&&this.setItemsFromData(b.data),this.$content.addClass("oo-ui-capsuleMultiselectWidget-content").append(this.$group),this.$group.addClass("oo-ui-capsuleMultiselectWidget-group"),this.$handle.addClass("oo-ui-capsuleMultiselectWidget-handle").append(this.$indicator,this.$icon,this.$content),this.$element.addClass("oo-ui-capsuleMultiselectWidget").append(this.$handle),this.popup?(this.popup.$element.addClass("oo-ui-capsuleMultiselectWidget-popup"),this.$content.append(c),this.$overlay.append(this.popup.$element)):(this.$content.append(this.$input),this.$overlay.append(this.menu.$element)),c&&c.addClass("oo-ui-capsuleMultiselectWidget-focusTrap"),setTimeout(function(){this.$input&&this.updateInputSize()}.bind(this)),this.onMenuItemsChange()},a.inheritClass(a.ui.CapsuleMultiselectWidget,a.ui.Widget),a.mixinClass(a.ui.CapsuleMultiselectWidget,a.ui.mixin.GroupElement),a.mixinClass(a.ui.CapsuleMultiselectWidget,a.ui.mixin.PopupElement),a.mixinClass(a.ui.CapsuleMultiselectWidget,a.ui.mixin.TabIndexedElement);a.mixinClass(a.ui.CapsuleMultiselectWidget,a.ui.mixin.IndicatorElement);a.mixinClass(a.ui.CapsuleMultiselectWidget,a.ui.mixin.IconElement),a.ui.CapsuleMultiselectWidget.static.supportsSimpleLabel=!0,a.ui.CapsuleMultiselectWidget.prototype.createItemWidget=function(b,c){return""===c?null:new a.ui.CapsuleItemWidget({data:b,label:c})},a.ui.CapsuleMultiselectWidget.prototype.getInputId=function(){var b;return!!this.$input&&(b=this.$input.attr("id"),void 0===b&&(b=a.ui.generateElementId(),this.$input.attr("id",b)),b)},a.ui.CapsuleMultiselectWidget.prototype.getItemsData=function(){return this.getItems().map(function(a){return a.data})},a.ui.CapsuleMultiselectWidget.prototype.setItemsFromData=function(a){var b=this,c=this.menu,d=this.getItems();return $.each(a,function(a,e){var f,g,h=c.getItemFromData(e);if(h)g=h.label;else{if(!b.allowArbitrary)return;g=String(e)}for(h=null,f=0;f<d.length;f++)if(d[f].data===e&&d[f].label===g){h=d[f],d.splice(f,1);break}h||(h=b.createItemWidget(e,g)),h&&b.addItems([h],a)}),d.length&&b.removeItems(d),this},a.ui.CapsuleMultiselectWidget.prototype.addItemsFromData=function(a){var b=this,c=this.menu,d=[];return $.each(a,function(a,e){var f;b.getItemFromData(e)&&!b.allowDuplicates||(f=c.getItemFromData(e),f?f=b.createItemWidget(e,f.label):b.allowArbitrary&&(f=b.createItemWidget(e,String(e))),f&&d.push(f))}),d.length&&this.addItems(d),this},a.ui.CapsuleMultiselectWidget.prototype.addItemFromLabel=function(b){var c,d;return c=this.menu.getItemFromLabel(b,!0),c?(this.addItemsFromData([c.data]),!0):!!this.allowArbitrary&&(d=this.getItems(),this.addItemsFromData([b]),!a.compare(this.getItems(),d))},a.ui.CapsuleMultiselectWidget.prototype.removeItemsFromData=function(a){var b=this,c=[];return $.each(a,function(a,d){var e=b.getItemFromData(d);e&&c.push(e)}),c.length&&this.removeItems(c),this},a.ui.CapsuleMultiselectWidget.prototype.addItems=function(b){var c,d,e,f=this.items.slice();if(a.ui.mixin.GroupElement.prototype.addItems.call(this,b),this.items.length!==f.length)c=!1;else for(c=!0,d=0,e=f.length;c&&d<e;d++)c=c&&this.items[d]===f[d];return c||(this.emit("change",this.getItemsData()),this.updateIfHeightChanged()),this},a.ui.CapsuleMultiselectWidget.prototype.editItem=function(a){this.addItemFromLabel(this.$input.val()),this.clearInput(),this.$input.val(a.label),this.updateInputSize(),this.focus(),this.menu.updateItemVisibility(),this.removeItems([a])},a.ui.CapsuleMultiselectWidget.prototype.removeItems=function(b){var c,d,e,f=this.items.slice();if(a.ui.mixin.GroupElement.prototype.removeItems.call(this,b),this.items.length!==f.length)c=!1;else for(c=!0,d=0,e=f.length;c&&d<e;d++)c=c&&this.items[d]===f[d];return c||(this.emit("change",this.getItemsData()),this.updateIfHeightChanged()),this},a.ui.CapsuleMultiselectWidget.prototype.clearItems=function(){return this.items.length&&(a.ui.mixin.GroupElement.prototype.clearItems.call(this),this.emit("change",this.getItemsData()),this.updateIfHeightChanged()),this},a.ui.CapsuleMultiselectWidget.prototype.getNextItem=function(a){var b;return void 0===a?this.items[0]:(b=this.items.indexOf(a),!(b<0)&&(b===this.items.length-1?this.$input:this.items[b+1]))},a.ui.CapsuleMultiselectWidget.prototype.getPreviousItem=function(a){var b;return void 0===a?this.items[this.items.length-1]:(b=this.items.indexOf(a),!(b<0)&&(0===b?this.$input:this.items[b-1]))},a.ui.CapsuleMultiselectWidget.prototype.getMenu=function(){return this.menu},a.ui.CapsuleMultiselectWidget.prototype.onInputFocus=function(){this.isDisabled()||this.menu.toggle(!0)},a.ui.CapsuleMultiselectWidget.prototype.onInputBlur=function(){this.addItemFromLabel(this.$input.val()),this.clearInput()},a.ui.CapsuleMultiselectWidget.prototype.onPopupFocusOut=function(){var b=this.popup;setTimeout(function(){b.isVisible()&&!a.ui.contains(b.$element.add(b.$autoCloseIgnore).get(),document.activeElement,!0)&&b.toggle(!1)})},a.ui.CapsuleMultiselectWidget.prototype.onMouseDown=function(b){return b.which===a.ui.MouseButtons.LEFT?(this.focus(),!1):void this.updateInputSize()},a.ui.CapsuleMultiselectWidget.prototype.onKeyPress=function(b){if(!this.isDisabled()){if(b.which===a.ui.Keys.ESCAPE)return this.clearInput(),!1;if(!this.popup){if(this.menu.toggle(!0),b.which===a.ui.Keys.ENTER)return this.addItemFromLabel(this.$input.val())&&this.clearInput(),!1;setTimeout(this.updateInputSize.bind(this),0)}}},a.ui.CapsuleMultiselectWidget.prototype.onKeyDown=function(b){if(!this.isDisabled()&&""===this.$input.val()&&this.items.length){if(b.keyCode===a.ui.Keys.BACKSPACE)return b.metaKey||b.ctrlKey?this.removeItems(this.items.slice(-1)):this.editItem(this.items[this.items.length-1]),!1;b.keyCode===a.ui.Keys.LEFT?this.getPreviousItem().focus():b.keyCode===a.ui.Keys.RIGHT&&this.getNextItem().focus()}},a.ui.CapsuleMultiselectWidget.prototype.updateInputSize=function(){var b,c,d,e,f;if(this.$input&&!this.isDisabled()){if(this.$input.css("width","1em"),b=this.$group.children().last(),c=a.ui.Element.static.getDir(this.$handle),void 0===this.contentWidthWithPlaceholder&&""===this.$input.val()&&void 0!==this.$input.attr("placeholder")&&(this.$input.val(this.$input.attr("placeholder")),this.contentWidthWithPlaceholder=this.$input[0].scrollWidth,this.$input.val("")),d=Math.max(this.$input[0].scrollWidth,void 0===this.contentWidthWithPlaceholder?0:this.contentWidthWithPlaceholder),e=this.$input.width(),d<e)return;f=0===b.length?this.$content.innerWidth():"ltr"===c?this.$content.innerWidth()-b.position().left-b.outerWidth():b.position().left,f-=10,d>f&&(f=this.$content.innerWidth()-10),this.$input.width(Math.floor(f)),this.updateIfHeightChanged()}},a.ui.CapsuleMultiselectWidget.prototype.updateIfHeightChanged=function(){var a=this.$element.height();a!==this.height&&(this.height=a,this.menu.position(),this.popup&&this.popup.updateDimensions(),this.emit("resize"))},a.ui.CapsuleMultiselectWidget.prototype.onMenuChoose=function(a){a&&a.isVisible()&&(this.addItemsFromData([a.getData()]),this.clearInput())},a.ui.CapsuleMultiselectWidget.prototype.onMenuToggle=function(a){this.$element.toggleClass("oo-ui-capsuleMultiselectWidget-open",a)},a.ui.CapsuleMultiselectWidget.prototype.onMenuItemsChange=function(){this.setItemsFromData(this.getItemsData()),this.$element.toggleClass("oo-ui-capsuleMultiselectWidget-empty",this.menu.isEmpty())},a.ui.CapsuleMultiselectWidget.prototype.clearInput=function(){this.$input&&(this.$input.val(""),this.updateInputSize()),this.popup&&this.popup.toggle(!1),this.menu.toggle(!1),this.menu.selectItem(),this.menu.highlightItem()},a.ui.CapsuleMultiselectWidget.prototype.setDisabled=function(b){var c,d;if(a.ui.CapsuleMultiselectWidget.parent.prototype.setDisabled.call(this,b),this.$input&&this.$input.prop("disabled",this.isDisabled()),this.menu&&this.menu.setDisabled(this.isDisabled()),this.popup&&this.popup.setDisabled(this.isDisabled()),this.items)for(c=0,d=this.items.length;c<d;c++)this.items[c].updateDisabled();return this},a.ui.CapsuleMultiselectWidget.prototype.focus=function(){return this.isDisabled()||(this.popup?(this.popup.setSize(this.$handle.outerWidth()),this.popup.toggle(!0),a.ui.findFocusable(this.popup.$element).focus()):(this.updateInputSize(),this.menu.toggle(!0),this.$input.focus())),this},a.ui.CapsuleMultiSelectWidget=function(){a.ui.warnDeprecation("CapsuleMultiSelectWidget is deprecated. Use the CapsuleMultiselectWidget instead."),a.ui.CapsuleMultiSelectWidget.parent.apply(this,arguments)},a.inheritClass(a.ui.CapsuleMultiSelectWidget,a.ui.CapsuleMultiselectWidget),a.ui.SelectFileWidget=function(b){var c;b=$.extend({accept:null,placeholder:a.ui.msg("ooui-selectfile-placeholder"),notsupported:a.ui.msg("ooui-selectfile-not-supported"),droppable:!0,showDropTarget:!1,thumbnailSizeLimit:20},b),a.ui.SelectFileWidget.parent.call(this,b),a.ui.mixin.IconElement.call(this,b),a.ui.mixin.IndicatorElement.call(this,b),a.ui.mixin.PendingElement.call(this,$.extend({},b,{$pending:this.$info})),a.ui.mixin.LabelElement.call(this,b),this.$info=$("<span>"),this.showDropTarget=b.showDropTarget,this.thumbnailSizeLimit=b.thumbnailSizeLimit,this.isSupported=this.constructor.static.isSupported(),this.currentFile=null,Array.isArray(b.accept)?this.accept=b.accept:this.accept=null,this.placeholder=b.placeholder,this.notsupported=b.notsupported,this.onFileSelectedHandler=this.onFileSelected.bind(this),this.selectButton=new a.ui.ButtonWidget({classes:["oo-ui-selectFileWidget-selectButton"],label:a.ui.msg("ooui-selectfile-button-select"),disabled:this.disabled||!this.isSupported}),this.clearButton=new a.ui.ButtonWidget({classes:["oo-ui-selectFileWidget-clearButton"],framed:!1,icon:"close",disabled:this.disabled}),this.selectButton.$button.on({keypress:this.onKeyPress.bind(this)}),this.clearButton.connect(this,{click:"onClearClick"}),b.droppable&&(c=this.onDragEnterOrOver.bind(this),this.$element.on({dragenter:c,dragover:c,dragleave:this.onDragLeave.bind(this),drop:this.onDrop.bind(this)})),this.addInput(),this.$label.addClass("oo-ui-selectFileWidget-label"),this.$info.addClass("oo-ui-selectFileWidget-info").append(this.$icon,this.$label,this.clearButton.$element,this.$indicator),b.droppable&&b.showDropTarget?(this.selectButton.setIcon("upload"),this.$thumbnail=$("<div>").addClass("oo-ui-selectFileWidget-thumbnail"),this.setPendingElement(this.$thumbnail),this.$element.addClass("oo-ui-selectFileWidget-dropTarget oo-ui-selectFileWidget").on({click:this.onDropTargetClick.bind(this)}).append(this.$thumbnail,this.$info,this.selectButton.$element,$("<span>").addClass("oo-ui-selectFileWidget-dropLabel").text(a.ui.msg("ooui-selectfile-dragdrop-placeholder")))):this.$element.addClass("oo-ui-selectFileWidget").append(this.$info,this.selectButton.$element),this.updateUI()},a.inheritClass(a.ui.SelectFileWidget,a.ui.Widget),a.mixinClass(a.ui.SelectFileWidget,a.ui.mixin.IconElement),a.mixinClass(a.ui.SelectFileWidget,a.ui.mixin.IndicatorElement),a.mixinClass(a.ui.SelectFileWidget,a.ui.mixin.PendingElement),a.mixinClass(a.ui.SelectFileWidget,a.ui.mixin.LabelElement),a.ui.SelectFileWidget.static.isSupported=function(){var b;return null===a.ui.SelectFileWidget.static.isSupportedCache&&(b=$("<input>").attr("type","file"),a.ui.SelectFileWidget.static.isSupportedCache=void 0!==b[0].files),a.ui.SelectFileWidget.static.isSupportedCache},a.ui.SelectFileWidget.static.isSupportedCache=null,a.ui.SelectFileWidget.prototype.getValue=function(){return this.currentFile},a.ui.SelectFileWidget.prototype.setValue=function(a){this.currentFile!==a&&(this.currentFile=a,this.updateUI(),this.emit("change",this.currentFile))},a.ui.SelectFileWidget.prototype.focus=function(){return this.selectButton.$button[0].focus(),this},a.ui.SelectFileWidget.prototype.updateUI=function(){var b;this.isSupported?(this.$element.addClass("oo-ui-selectFileWidget-supported"),this.currentFile?(this.$element.removeClass("oo-ui-selectFileWidget-empty"),b=$([]),b=b.add($("<span>").addClass("oo-ui-selectFileWidget-fileName").text(this.currentFile.name)),this.setLabel(b),this.showDropTarget&&(this.pushPending(),this.loadAndGetImageUrl().done(function(a){this.$thumbnail.css("background-image","url( "+a+" )")}.bind(this)).fail(function(){this.$thumbnail.append(new a.ui.IconWidget({icon:"attachment",classes:["oo-ui-selectFileWidget-noThumbnail-icon"]}).$element)}.bind(this)).always(function(){this.popPending()}.bind(this)),this.$element.off("click"))):(this.showDropTarget&&(this.$element.off("click"),this.$element.on({click:this.onDropTargetClick.bind(this)}),this.$thumbnail.empty().css("background-image","")),this.$element.addClass("oo-ui-selectFileWidget-empty"),this.setLabel(this.placeholder))):(this.$element.addClass("oo-ui-selectFileWidget-notsupported"),this.$element.removeClass("oo-ui-selectFileWidget-empty"),this.setLabel(this.notsupported))},a.ui.SelectFileWidget.prototype.loadAndGetImageUrl=function(){var b=$.Deferred(),c=this.currentFile,d=new FileReader;return c&&0===(a.getProp(c,"type")||"").indexOf("image/")&&c.size<1024*this.thumbnailSizeLimit*1024?(d.onload=function(a){var c=document.createElement("img");c.addEventListener("load",function(){0===c.naturalWidth||0===c.naturalHeight||c.complete===!1?b.reject():b.resolve(a.target.result)}),c.src=a.target.result},d.readAsDataURL(c)):b.reject(),b.promise()},a.ui.SelectFileWidget.prototype.addInput=function(){return this.$input&&this.$input.remove(),this.isSupported?(this.$input=$("<input>").attr("type","file"),this.$input.on("change",this.onFileSelectedHandler),this.$input.on("click",function(a){a.stopPropagation()}),this.$input.attr({tabindex:-1}),this.accept&&this.$input.attr("accept",this.accept.join(", ")),void this.selectButton.$button.append(this.$input)):void(this.$input=null)},a.ui.SelectFileWidget.prototype.isAllowedType=function(a){var b,c;if(!this.accept||!a)return!0;for(b=0;b<this.accept.length;b++){if(c=this.accept[b],c===a)return!0;if("/*"===c.substr(-2)&&(c=c.substr(0,c.length-1),a.substr(0,c.length)===c))return!0}return!1},a.ui.SelectFileWidget.prototype.onFileSelected=function(b){var c=a.getProp(b.target,"files",0)||null;c&&!this.isAllowedType(c.type)&&(c=null),this.setValue(c),this.addInput()},a.ui.SelectFileWidget.prototype.onClearClick=function(){return this.setValue(null),!1},a.ui.SelectFileWidget.prototype.onKeyPress=function(b){if(this.isSupported&&!this.isDisabled()&&this.$input&&(b.which===a.ui.Keys.SPACE||b.which===a.ui.Keys.ENTER))return this.$input.click(),!1},a.ui.SelectFileWidget.prototype.onDropTargetClick=function(){if(this.isSupported&&!this.isDisabled()&&this.$input)return this.$input.click(),!1},a.ui.SelectFileWidget.prototype.onDragEnterOrOver=function(b){var c,d=!1,e=b.originalEvent.dataTransfer;return b.preventDefault(),b.stopPropagation(),this.isDisabled()||!this.isSupported?(this.$element.removeClass("oo-ui-selectFileWidget-canDrop"),e.dropEffect="none",!1):(c=a.getProp(e,"items",0)||a.getProp(e,"files",0),c?this.isAllowedType(c.type)&&(d=!0):Array.prototype.indexOf.call(a.getProp(e,"types")||[],"Files")!==-1&&(d=!0),this.$element.toggleClass("oo-ui-selectFileWidget-canDrop",d),d||(e.dropEffect="none"),!1)},a.ui.SelectFileWidget.prototype.onDragLeave=function(){this.$element.removeClass("oo-ui-selectFileWidget-canDrop")},a.ui.SelectFileWidget.prototype.onDrop=function(b){var c=null,d=b.originalEvent.dataTransfer;return b.preventDefault(),b.stopPropagation(),this.$element.removeClass("oo-ui-selectFileWidget-canDrop"),!(this.isDisabled()||!this.isSupported)&&(c=a.getProp(d,"files",0),c&&!this.isAllowedType(c.type)&&(c=null),c&&this.setValue(c),!1)},a.ui.SelectFileWidget.prototype.setDisabled=function(b){return a.ui.SelectFileWidget.parent.prototype.setDisabled.call(this,b),this.selectButton&&this.selectButton.setDisabled(b),this.clearButton&&this.clearButton.setDisabled(b),this},a.ui.SearchWidget=function(b){b=b||{},a.ui.SearchWidget.parent.call(this,b),this.query=new a.ui.TextInputWidget({icon:"search",placeholder:b.placeholder,value:b.value}),this.results=new a.ui.SelectWidget,this.$query=$("<div>"),this.$results=$("<div>"),this.query.connect(this,{change:"onQueryChange",enter:"onQueryEnter"}),this.query.$input.on("keydown",this.onQueryKeydown.bind(this)),this.$query.addClass("oo-ui-searchWidget-query").append(this.query.$element),this.$results.addClass("oo-ui-searchWidget-results").append(this.results.$element),this.$element.addClass("oo-ui-searchWidget").append(this.$results,this.$query)},a.inheritClass(a.ui.SearchWidget,a.ui.Widget),a.ui.SearchWidget.prototype.onQueryKeydown=function(b){var c,d,e=b.which===a.ui.Keys.DOWN?1:b.which===a.ui.Keys.UP?-1:0;e&&(c=this.results.getHighlightedItem(),c||(c=this.results.getSelectedItem()),d=this.results.getRelativeSelectableItem(c,e),this.results.highlightItem(d),d.scrollElementIntoView())},a.ui.SearchWidget.prototype.onQueryChange=function(){this.results.clearItems()},a.ui.SearchWidget.prototype.onQueryEnter=function(){var a=this.results.getHighlightedItem();a&&this.results.chooseItem(a)},a.ui.SearchWidget.prototype.getQuery=function(){return this.query},a.ui.SearchWidget.prototype.getResults=function(){return this.results},a.ui.NumberInputWidget=function(b){b=$.extend({isInteger:!1,min:-(1/0),max:1/0,step:1,pageStep:null,showButtons:!0},b),a.ui.NumberInputWidget.parent.call(this,b),this.input=new a.ui.TextInputWidget($.extend({disabled:this.isDisabled(),type:"number"},b.input)),b.showButtons&&(this.minusButton=new a.ui.ButtonWidget($.extend({disabled:this.isDisabled(),tabIndex:-1,classes:["oo-ui-numberInputWidget-minusButton"],label:"−"},b.minusButton)),this.plusButton=new a.ui.ButtonWidget($.extend({disabled:this.isDisabled(),tabIndex:-1,classes:["oo-ui-numberInputWidget-plusButton"],label:"+"},b.plusButton))),this.input.connect(this,{change:this.emit.bind(this,"change"),enter:this.emit.bind(this,"enter")}),this.input.$input.on({keydown:this.onKeyDown.bind(this),"wheel mousewheel DOMMouseScroll":this.onWheel.bind(this)}),b.showButtons&&(this.plusButton.connect(this,{click:["onButtonClick",1]}),this.minusButton.connect(this,{click:["onButtonClick",-1]})),this.setIsInteger(!!b.isInteger),this.setRange(b.min,b.max),this.setStep(b.step,b.pageStep),this.$field=$("<div>").addClass("oo-ui-numberInputWidget-field").append(this.input.$element),this.$element.addClass("oo-ui-numberInputWidget").append(this.$field),b.showButtons&&(this.$field.prepend(this.minusButton.$element).append(this.plusButton.$element),this.$element.addClass("oo-ui-numberInputWidget-buttoned")),this.input.setValidation(this.validateNumber.bind(this))},a.inheritClass(a.ui.NumberInputWidget,a.ui.Widget),a.ui.NumberInputWidget.prototype.setIsInteger=function(a){this.isInteger=!!a,this.input.setValidityFlag()},a.ui.NumberInputWidget.prototype.getIsInteger=function(){return this.isInteger},a.ui.NumberInputWidget.prototype.setRange=function(a,b){if(a>b)throw new Error("Minimum ("+a+") must not be greater than maximum ("+b+")");this.min=a,this.max=b,this.input.setValidityFlag()},a.ui.NumberInputWidget.prototype.getRange=function(){return[this.min,this.max]},a.ui.NumberInputWidget.prototype.setStep=function(a,b){if(a<=0)throw new Error("Step value must be positive");if(null===b)b=10*a;else if(b<=0)throw new Error("Page step value must be positive");this.step=a,this.pageStep=b},a.ui.NumberInputWidget.prototype.getStep=function(){return[this.step,this.pageStep]},a.ui.NumberInputWidget.prototype.getValue=function(){return this.input.getValue()},a.ui.NumberInputWidget.prototype.getNumericValue=function(){return+this.input.getValue()},a.ui.NumberInputWidget.prototype.setValue=function(a){this.input.setValue(a)},a.ui.NumberInputWidget.prototype.adjustValue=function(a){var b,c=this.getNumericValue();if(a=+a,isNaN(a)||!isFinite(a))throw new Error("Delta must be a finite number");isNaN(c)?b=0:(b=c+a,b=Math.max(Math.min(b,this.max),this.min),this.isInteger&&(b=Math.round(b))),b!==c&&this.setValue(b)},a.ui.NumberInputWidget.prototype.validateNumber=function(a){var b=+a;return!(isNaN(b)||!isFinite(b))&&((!this.isInteger||Math.floor(b)===b)&&!(b<this.min||b>this.max))},a.ui.NumberInputWidget.prototype.onButtonClick=function(a){this.adjustValue(a*this.step)},a.ui.NumberInputWidget.prototype.onWheel=function(a){var b=0;if(!this.isDisabled()&&this.input.$input.is(":focus"))return void 0!==a.originalEvent.deltaMode&&(this.sawWheelEvent=!0),a.originalEvent.deltaY?b=-a.originalEvent.deltaY:a.originalEvent.deltaX&&(b=a.originalEvent.deltaX),this.sawWheelEvent||(a.originalEvent.wheelDeltaX?b=-a.originalEvent.wheelDeltaX:a.originalEvent.wheelDeltaY?b=a.originalEvent.wheelDeltaY:a.originalEvent.wheelDelta?b=a.originalEvent.wheelDelta:a.originalEvent.detail&&(b=-a.originalEvent.detail)),b&&(b=b<0?-1:1,this.adjustValue(b*this.step)),!1},a.ui.NumberInputWidget.prototype.onKeyDown=function(b){if(!this.isDisabled())switch(b.which){case a.ui.Keys.UP:return this.adjustValue(this.step),!1;case a.ui.Keys.DOWN:return this.adjustValue(-this.step),!1;case a.ui.Keys.PAGEUP:return this.adjustValue(this.pageStep),!1;case a.ui.Keys.PAGEDOWN:return this.adjustValue(-this.pageStep),!1}},a.ui.NumberInputWidget.prototype.setDisabled=function(b){return a.ui.NumberInputWidget.parent.prototype.setDisabled.call(this,b),this.input&&this.input.setDisabled(this.isDisabled()),this.minusButton&&this.minusButton.setDisabled(this.isDisabled()),this.plusButton&&this.plusButton.setDisabled(this.isDisabled()),this}}(OO);
//# sourceMappingURL=oojs-ui-widgets.min.js.map